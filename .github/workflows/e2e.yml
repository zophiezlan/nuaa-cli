name: E2E CLI Smoke Test

on:
    pull_request:
    push:

jobs:
    e2e:
        name: E2E (Python ${{ matrix.python-version }} â€¢ ${{ matrix.os }})
        runs-on: ${{ matrix.os }}
        strategy:
            fail-fast: false
            matrix:
                os: [ubuntu-latest, windows-latest]
                python-version: ["3.12"]

        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Setup Python
              uses: actions/setup-python@v5
              with:
                  python-version: ${{ matrix.python-version }}
                  cache: "pip"
                  cache-dependency-path: |
                      pyproject.toml

            - name: Upgrade pip
              run: python -m pip install --upgrade pip

            - name: Install CLI (with dev deps for auto-fix)
              run: pip install -e .[dev]

            - name: ðŸ”§ Auto-fix linting issues (REQUIRED before tests)
              uses: ./.github/actions/auto-fix-lint

            - name: Run E2E smoke test
              shell: bash
              run: |
                  python scripts/python/e2e_smoke_test.py
